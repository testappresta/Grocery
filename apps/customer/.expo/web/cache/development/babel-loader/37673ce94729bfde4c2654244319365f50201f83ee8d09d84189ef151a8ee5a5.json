{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar API_BASE_URL = 'https://your-api-domain.com/api/v1';\nexport var api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napi.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    var token = yield AsyncStorage.getItem('accessToken');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  return Promise.reject(error);\n});\napi.interceptors.response.use(function (response) {\n  return response;\n}, function () {\n  var _ref2 = _asyncToGenerator(function* (error) {\n    var _error$response;\n    if (((_error$response = error.response) == null ? void 0 : _error$response.status) === 401) {\n      var refreshToken = yield AsyncStorage.getItem('refreshToken');\n      if (refreshToken) {\n        try {\n          var response = yield axios.post(`${API_BASE_URL}/auth/refresh-token`, {\n            refreshToken: refreshToken\n          });\n          var _response$data$data = response.data.data,\n            accessToken = _response$data$data.accessToken,\n            newRefreshToken = _response$data$data.refreshToken;\n          yield AsyncStorage.setItem('accessToken', accessToken);\n          yield AsyncStorage.setItem('refreshToken', newRefreshToken);\n          error.config.headers.Authorization = `Bearer ${accessToken}`;\n          return axios(error.config);\n        } catch (refreshError) {\n          yield AsyncStorage.multiRemove(['accessToken', 'refreshToken']);\n        }\n      }\n    }\n    return Promise.reject(error);\n  });\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport var authAPI = {\n  sendCode: function sendCode(phone) {\n    return api.post('/auth/send-code', {\n      phone: phone\n    });\n  },\n  loginWithPhone: function loginWithPhone(phone, code) {\n    return api.post('/auth/login-phone', {\n      phone: phone,\n      code: code\n    });\n  },\n  loginWithEmail: function loginWithEmail(email, password) {\n    return api.post('/auth/login-email', {\n      email: email,\n      password: password\n    });\n  },\n  register: function register(data) {\n    return api.post('/auth/register', data);\n  },\n  getProfile: function getProfile() {\n    return api.get('/auth/me');\n  }\n};\nexport var productAPI = {\n  getProducts: function getProducts(params) {\n    return api.get('/products', {\n      params: params\n    });\n  },\n  getProduct: function getProduct(id) {\n    return api.get(`/products/${id}`);\n  },\n  searchProducts: function searchProducts(q) {\n    return api.get('/products/search', {\n      params: {\n        q: q\n      }\n    });\n  },\n  getFeatured: function getFeatured() {\n    return api.get('/products/featured');\n  }\n};\nexport var storeAPI = {\n  getStores: function getStores(params) {\n    return api.get('/stores', {\n      params: params\n    });\n  },\n  getStore: function getStore(id) {\n    return api.get(`/stores/${id}`);\n  },\n  getStoreProducts: function getStoreProducts(id, params) {\n    return api.get(`/stores/${id}/products`, {\n      params: params\n    });\n  },\n  getNearby: function getNearby(lat, lng) {\n    return api.get('/stores/nearby', {\n      params: {\n        lat: lat,\n        lng: lng\n      }\n    });\n  }\n};\nexport var cartAPI = {\n  getCart: function getCart() {\n    return api.get('/cart');\n  },\n  addToCart: function addToCart(productId, quantity) {\n    return api.post('/cart/items', {\n      productId: productId,\n      quantity: quantity\n    });\n  },\n  updateItem: function updateItem(productId, quantity) {\n    return api.put(`/cart/items/${productId}`, {\n      quantity: quantity\n    });\n  },\n  removeItem: function removeItem(productId) {\n    return api.delete(`/cart/items/${productId}`);\n  },\n  clearCart: function clearCart() {\n    return api.delete('/cart');\n  }\n};\nexport var orderAPI = {\n  getOrders: function getOrders(params) {\n    return api.get('/orders', {\n      params: params\n    });\n  },\n  getOrder: function getOrder(id) {\n    return api.get(`/orders/${id}`);\n  },\n  createOrder: function createOrder(data) {\n    return api.post('/orders', data);\n  },\n  cancelOrder: function cancelOrder(id) {\n    return api.put(`/orders/${id}/cancel`);\n  }\n};\nexport var userAPI = {\n  getAddresses: function getAddresses() {\n    return api.get('/addresses');\n  },\n  addAddress: function addAddress(data) {\n    return api.post('/addresses', data);\n  },\n  updateAddress: function updateAddress(id, data) {\n    return api.put(`/addresses/${id}`, data);\n  },\n  deleteAddress: function deleteAddress(id) {\n    return api.delete(`/addresses/${id}`);\n  },\n  setDefaultAddress: function setDefaultAddress(id) {\n    return api.put(`/addresses/${id}/default`);\n  }\n};","map":{"version":3,"names":["axios","AsyncStorage","API_BASE_URL","api","create","baseURL","timeout","headers","interceptors","request","use","_ref","_asyncToGenerator","config","token","getItem","Authorization","_x","apply","arguments","error","Promise","reject","response","_ref2","_error$response","status","refreshToken","post","_response$data$data","data","accessToken","newRefreshToken","setItem","refreshError","multiRemove","_x2","authAPI","sendCode","phone","loginWithPhone","code","loginWithEmail","email","password","register","getProfile","get","productAPI","getProducts","params","getProduct","id","searchProducts","q","getFeatured","storeAPI","getStores","getStore","getStoreProducts","getNearby","lat","lng","cartAPI","getCart","addToCart","productId","quantity","updateItem","put","removeItem","delete","clearCart","orderAPI","getOrders","getOrder","createOrder","cancelOrder","userAPI","getAddresses","addAddress","updateAddress","deleteAddress","setDefaultAddress"],"sources":["/workspace/apps/customer/services/api.ts"],"sourcesContent":["import axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nconst API_BASE_URL = 'https://your-api-domain.com/api/v1';\n\nexport const api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// 请求拦截器 - 添加 token\napi.interceptors.request.use(\n  async (config) => {\n    const token = await AsyncStorage.getItem('accessToken');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// 响应拦截器 - 处理错误\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    if (error.response?.status === 401) {\n      // Token 过期，尝试刷新\n      const refreshToken = await AsyncStorage.getItem('refreshToken');\n      if (refreshToken) {\n        try {\n          const response = await axios.post(`${API_BASE_URL}/auth/refresh-token`, {\n            refreshToken,\n          });\n          const { accessToken, refreshToken: newRefreshToken } = response.data.data;\n          \n          await AsyncStorage.setItem('accessToken', accessToken);\n          await AsyncStorage.setItem('refreshToken', newRefreshToken);\n          \n          // 重试原请求\n          error.config.headers.Authorization = `Bearer ${accessToken}`;\n          return axios(error.config);\n        } catch (refreshError) {\n          // 刷新失败，清除 token 并跳转到登录\n          await AsyncStorage.multiRemove(['accessToken', 'refreshToken']);\n          // 这里可以触发导航到登录页面\n        }\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n// API 方法\nexport const authAPI = {\n  sendCode: (phone: string) => api.post('/auth/send-code', { phone }),\n  loginWithPhone: (phone: string, code: string) =>\n    api.post('/auth/login-phone', { phone, code }),\n  loginWithEmail: (email: string, password: string) =>\n    api.post('/auth/login-email', { email, password }),\n  register: (data: any) => api.post('/auth/register', data),\n  getProfile: () => api.get('/auth/me'),\n};\n\nexport const productAPI = {\n  getProducts: (params?: any) => api.get('/products', { params }),\n  getProduct: (id: string) => api.get(`/products/${id}`),\n  searchProducts: (q: string) => api.get('/products/search', { params: { q } }),\n  getFeatured: () => api.get('/products/featured'),\n};\n\nexport const storeAPI = {\n  getStores: (params?: any) => api.get('/stores', { params }),\n  getStore: (id: string) => api.get(`/stores/${id}`),\n  getStoreProducts: (id: string, params?: any) =>\n    api.get(`/stores/${id}/products`, { params }),\n  getNearby: (lat: number, lng: number) =>\n    api.get('/stores/nearby', { params: { lat, lng } }),\n};\n\nexport const cartAPI = {\n  getCart: () => api.get('/cart'),\n  addToCart: (productId: string, quantity: number) =>\n    api.post('/cart/items', { productId, quantity }),\n  updateItem: (productId: string, quantity: number) =>\n    api.put(`/cart/items/${productId}`, { quantity }),\n  removeItem: (productId: string) => api.delete(`/cart/items/${productId}`),\n  clearCart: () => api.delete('/cart'),\n};\n\nexport const orderAPI = {\n  getOrders: (params?: any) => api.get('/orders', { params }),\n  getOrder: (id: string) => api.get(`/orders/${id}`),\n  createOrder: (data: any) => api.post('/orders', data),\n  cancelOrder: (id: string) => api.put(`/orders/${id}/cancel`),\n};\n\nexport const userAPI = {\n  getAddresses: () => api.get('/addresses'),\n  addAddress: (data: any) => api.post('/addresses', data),\n  updateAddress: (id: string, data: any) => api.put(`/addresses/${id}`, data),\n  deleteAddress: (id: string) => api.delete(`/addresses/${id}`),\n  setDefaultAddress: (id: string) => api.put(`/addresses/${id}/default`),\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}